---
layout: post
title:  "Перебудова ядра Arch linux"
ref:    2018-03-26-kernel
lang:   uk
date:   2018-03-26 07:13:36 +03:00
tags:   linux
---

Виявляється, кожен мій ноутбук так чи інакше потребував особливого ядра.
Наприклад, [Acer
C720](https://www.acer.com/ac/en/CA/content/series/c720) мав менш популярний
сенсор світла, HP потребував певну версію драйверів WiFi тощо. Навіть цього разу,
[Xiaomi Mi Notebook Air](http://xiaomi-mi.com/notebooks/xiaomi-mi-notebook-air-125-silver),
не дуже добре працює із молодшими від 4.10 ядрами, тачпад стає смиканий.
На щастя, є пакунок AUR з ядром тривалої підтримки
[linux-lts49](https://aur.archlinux.org/packages/linux-lts49/). Нажаль,
його не можна зібрати у `tmpfs` через обмежений розмір. Проте виявляється, що
зібрати мінімальне ядро насправді дуже легко в Arch linux.

По-перше, є служба, яка записує назви модулів, які коли-небудь були завантажені
у системі:
[modprobed-db](https://wiki.archlinux.org/index.php/Modprobed-db). Її також
можна використовувати інтерактивно.

По-друге, в `PKGBUILD` треба додати лише один рядок:
```sh
make LSMOD=$HOME/.config/modprobed.db localmodconfig
```
Це сконфігурує збирання тільки певних модулів ядра, які справді потрібні.

Результат вражаючий:
* Збирання закінчується в межах 15 хвилин (набагато менше, ніж я пишу цей текст)
* Влазить у 2 ГБ `/tmp` з надлишком
* Ядро повністю функціональне
* Дуже легко підтримувати у актуальному стані
