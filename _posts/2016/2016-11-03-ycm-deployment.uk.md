---
layout: post
title:  "Компактне розгортання YouCompleteMe"
ref:    compact-ycm
lang:   uk
date:   2016-11-03 08:45:17 +0200
tags:   vim unix cpp
---

Кмітливе доповнення коду C++ найкраще зроблено в
[YouCompleteMe](http://valloric.github.io/YouCompleteMe),
на мою думку. Плагін швидкий, точний, кмітливий і до того ж легко встановити.
Проте, займає багато місця у файловій системі. На приклад,
після `python2 install.py --clang-completer`:

![Початковий розмір]({{ site.url }}/assets/2016-11/ycm-clang.png)

Так, півгігабайта для рушіїв доповнення C#, Go, Rust, копій boost і clang.
Звісно, добре мати із усіма залежностями всередині пакунок, який не залежить
від особливостей дистрибутиву. Але я б віддав перевагу більш інтегрованому
в систему компактному рішенню.

Першим кроком стало використання системних libclang і boost. Від цього відмовляє
автор плагіна, до речі. Після виправлення команди збірки до:
`python2 install.py --clang-completer --system-libclang --system-boost`:

![Розмір із системними бібліотеками]({{ site.url }}/assets/2016-11/ycm-clang-system.png)

Все ще чверть гігабайта. Потім відтинаємо істотний шмат: робимо власний сценарій встановлення.
Скрипт [update-ycm.sh](https://github.com/sakhnik/dotfiles/blob/7748834c4eecce9b9b97a6b4aadef638f209e9ef/.bin/update-ycm.sh)
робить кілька справ:

 * Клонує найновішу версію YouCompleteMe з github
 * Збирає її із увімкнений доповнювачем clang, компонуючи із системними бібліотеками
 * Прибирає найжирніші шматки
 * Розташовує обрізаний плагін у `~/.vim`
 * Поновлює глобальний `ycm_extra_conf.py` щоб співпадали шляхи до заголовків системної версії clang.

Нарешті, я задоволений використанням дискового простору того, що залишилося:

![Урізана власна версія плагіна]({{ site.url }}/assets/2016-11/ycm.png)

Щасливого кодування!

<!-- vim: set tw=78 spell -->
