---
layout: post
title:  "nvim-ui progress"
ref:    2022-07-24-nvim-ui
lang:   en
date:   2022-07-24 22:39:11 +03:00
tags:   cpp gtk
---

A year and a half passed since I set up to create a simple
[Neovim](https://neovim.io) UI in C++ in my spare time. The project
[nvim-ui](https://github.com/sakhnik/nvim-ui) evolved into an exciting
experience with quite a bit of discovery, experience and notable conclusions to
share.

First of all, the idea emerged when
[SpyUI](https://github.com/sakhnik/nvim-gdb/blob/master/test/spy_ui.py) was
implemented to support maintenance of my Neovim plugin
[nvim-gdb](https://github.com/sakhnik/nvim-gdb). It'd allow just mirroring and
capturing the UI progression during automatic tests or actual use cases to
simplify bug hunting. Not surprisingly, Neovim itself actively uses a UI client
for automatic testing. The script was embarrassingly simple suggesting that a
full-fledged UI shouldn't be too difficult either.

```
+----------------------------------------+
|                                        |
|~                                       |
|~                                       |
|~                                       |
|[No Name]             0,0-1          All|
|/src/test.cpp:17                        |
|/tmp/nvim-gdb/test/src/test.cpp:17:190:b|
|eg:0x5555555551e6                       |
|(gdb)                                   |
|<port -- gdb -q a.out 21,1           Bot|
|                                        |
|                                        |
|                                        |
|                                        |
|"/tmp/nvim-gdb/test/src/test.cpp"       |
+----------------------------------------+
```

So the first idea was to try out SDL2. Surely, it'd allow achieving superb
performance by with hardware acceleration!
TBD

Apparently, there's no way to fix the texture noise while using SDL2.
TBD

Then why not to create a UI using gtk4?
TBD

Writing in plane C becomes a horrible challenge when trying to identify how to
set text of the entry widget! Bringing in gtkmm seems an overkill for just a
handful of widgets I was intending to use.
Thus, [gir2cpp](https://github.com/sakhnik/gir2cpp).

Coping with the performance issues.
Too frequent flushes.
Having fine-grained widgets has a couple of drawbacks:

* `:digraphs` performance is horrible, it takes a noticeable 1/3 of a second to
    draw a page
* it's challenging to align vertical lines perfectly in Telescope.

So there we are after 1.5 years of experimentation.
The strengths:

* Simplicity of the idea
* Potential for implementing more features
* Solid foundation
